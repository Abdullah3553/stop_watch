#define F_CPU 1000000UL


#include<avr/io.h>
#include<avr/interrupt.h>
#include<util/delay.h>
#include"types.h"

#define RIGHT_DIGIT 0
#define LEFT_DIGIT  1

#define DIGIT_ERROR -1
typedef struct {
	uint8 hours, minutes, seconds;
}time;
time g_clock; /*Global clock*/

uint8 init_time()
{
	g_clock.hours = 0;
	g_clock.minutes = 0;
	g_clock.seconds = 0;
	return SUCCESS; /*Could be ignored*/
}

sint8 get_digit(uint8 number,uint8 digit )
{

	if(digit == RIGHT_DIGIT)
	{
        number = number % 10; 	/*Select the Least significant digit only*/
		return (sint8)number;
	}
	else if(digit == LEFT_DIGIT)
	{
		number = number % 100; 	/*To Select the last 2 digits only */
		number = number / 10;	/*To remove the ones digit*/
		return (sint8)number;
	}

	return DIGIT_ERROR;	/*digit was not RIGHT_DIGIT or LEFT_DIGIT*/
}

int main(void)
{
	init_time(); 	/*Set the clock to zero */

	DDRA |= 0x3f; 	/*Enable Pins for all 6 7-segments */
	PORTA &= 0xc0;	/*All enable Pins are OFF*/

	DDRC |= 0x0f; 	/*4 pins for 7-segment decoder digit */
	PORTC &= 0xf0; 	/*Set the decoder digit to 0*/

	while(1)
	{
		/*Display the digits on the 6 7-segments */

		/*enable the tens digit in the hours*/
		PORTA = ( PORTA & 0xc0 ) | ( 0b00000001 );
		/*Display the tens digit on the enabled 7-segment*/
		PORTC = ( PORTC & 0xf0 )
				| ( 0x0f & ( (uint8) get_digit(g_clock.hours, LEFT_DIGIT) ) );
		_delay_ms(2);

		/*enable the ones digit in the hours*/
		PORTA = ( PORTA & 0xc0 ) | ( 0b00000010 );
		/*Display the tens digit on the enabled 7-segment*/
		PORTC = ( PORTC & 0xf0 )
				| ( 0x0f & ( (uint8) get_digit(g_clock.hours, RIGHT_DIGIT) ) );
		_delay_ms(2);

		/*enable the tens digit in the minutes*/
		PORTA = ( PORTA & 0xc0 ) | ( 0b00000100 );
		/*Display the tens digit on the enabled 7-segment*/
		PORTC = ( PORTC & 0xf0 ) |
				( 0x0f & ( (uint8) get_digit(g_clock.minutes, LEFT_DIGIT) ) );
		_delay_ms(2);

		/*enable the ones digit in the minutes*/
		PORTA = ( PORTA & 0xc0 ) | ( 0b00001000 );
		/*Display the tens digit on the enabled 7-segment*/
		PORTC = ( PORTC & 0xf0 )
				| ( 0x0f & ( (uint8) get_digit(g_clock.minutes, RIGHT_DIGIT) ) );
		_delay_ms(2);

		/*enable the tens digit in the seconds*/
		PORTA = ( PORTA & 0xc0 ) | ( 0b00010000 );
		/*Display the tens digit on the enabled 7-segment*/
		PORTC = ( PORTC & 0xf0 )
				| ( 0x0f & ( (uint8) get_digit(g_clock.seconds, LEFT_DIGIT) ) );
		_delay_ms(2);

		/*enable the ones digit in the seconds*/
		PORTA = ( PORTA & 0xc0 ) | ( 0b00100000 );
		/*Display the tens digit on the enabled 7-segment*/
		PORTC = ( PORTC & 0xf0 )
				| ( 0x0f & ( (uint8) get_digit(g_clock.seconds, RIGHT_DIGIT) ) );
		_delay_ms(2);

	}/*While(1) end*/


}
